import{a,j as e}from"./vendor-react-Coyc-9rJ.js";import{u as v,c as h,a as w}from"./index-BahTgtJs.js";import{X as S,Q as P,F as y,m as R,a1 as k,T,g as A,a4 as D,a5 as I}from"./vendor-icons-CczvD28u.js";import{R as L,P as O,d as X,e as F,T as U}from"./vendor-recharts-8rfK60na.js";import"./vendor-DW9sAQKa.js";import"./vendor-zustand-Bm6pua9f.js";import"./vendor-uuid-CtRu48qb.js";function q({onClose:i}){const{addNCR:o}=v(),[p,b]=a.useState("Product"),[n,r]=a.useState(""),[c,d]=a.useState(""),[j,l]=a.useState(""),[x,g]=a.useState(""),[m,f]=a.useState(""),[u,N]=a.useState("Pending"),t=()=>{!n||!c||(o({type:p,title:n,description:c,detectedAt:new Date,lotNumber:j||void 0,productCode:x||void 0,quantity:m?parseInt(m):void 0,disposition:u,status:"Open",linkedCAPAs:[],isoReferences:[{standard:"ISO 13485:2016",clause:"8.3",description:"Control of nonconforming product"}]}),i())};return e.jsx("div",{className:"modal-overlay",onClick:i,children:e.jsxs("div",{className:"modal-content p-6",onClick:s=>s.stopPropagation(),children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"Create Non-Conformance Report"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Per ISO 13485:2016 Clause 8.3"})]}),e.jsx("button",{onClick:i,className:"p-1 rounded-md hover:bg-surface-100 text-gray-500",children:e.jsx(S,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"NCR Type *"}),e.jsxs("select",{value:p,onChange:s=>b(s.target.value),className:"input",children:[e.jsx("option",{value:"Product",children:"Product Nonconformance"}),e.jsx("option",{value:"Process",children:"Process Deviation"}),e.jsx("option",{value:"Documentation",children:"Documentation Error"}),e.jsx("option",{value:"Supplier",children:"Supplier Nonconformance"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Title *"}),e.jsx("input",{type:"text",value:n,onChange:s=>r(s.target.value),className:"input",placeholder:"Brief description of the nonconformance..."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Description *"}),e.jsx("textarea",{value:c,onChange:s=>d(s.target.value),rows:3,className:"input",placeholder:"Detailed description of the nonconformance, including how it was detected..."})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Lot Number"}),e.jsx("input",{type:"text",value:j,onChange:s=>l(s.target.value),className:"input",placeholder:"LOT-XXXXX"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Product Code"}),e.jsx("input",{type:"text",value:x,onChange:s=>g(s.target.value),className:"input",placeholder:"PROD-XXXXX"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Quantity Affected"}),e.jsx("input",{type:"number",value:m,onChange:s=>f(s.target.value),className:"input",placeholder:"0"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Initial Disposition"}),e.jsxs("select",{value:u,onChange:s=>N(s.target.value),className:"input",children:[e.jsx("option",{value:"Pending",children:"Pending Investigation"}),e.jsx("option",{value:"Rework",children:"Rework"}),e.jsx("option",{value:"Scrap",children:"Scrap"}),e.jsx("option",{value:"Use As Is",children:"Use As Is (with concession)"}),e.jsx("option",{value:"Return to Supplier",children:"Return to Supplier"})]}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Per ISO 13485:8.3 - Appropriate action shall be taken based on the nature of the nonconformity"})]})]}),e.jsxs("div",{className:"flex gap-3 mt-6",children:[e.jsx("button",{onClick:i,className:"btn-secondary flex-1",children:"Cancel"}),e.jsx("button",{onClick:t,disabled:!n||!c,className:"btn-primary flex-1 disabled:opacity-50 disabled:cursor-not-allowed",children:"Create NCR"})]})]})})}function V(){const{ncrs:i,updateNCR:o,getNCRStats:p}=v(),[b,n]=a.useState(!1),[r,c]=a.useState(""),[d,j]=a.useState("all"),l=p(),x=i.filter(t=>{const s=t.title.toLowerCase().includes(r.toLowerCase())||t.description.toLowerCase().includes(r.toLowerCase())||(t.lotNumber?.toLowerCase().includes(r.toLowerCase())??!1),C=d==="all"||t.type===d;return s&&C}),g=t=>{switch(t){case"Product":return e.jsx(I,{className:"w-4 h-4"});case"Process":return e.jsx(D,{className:"w-4 h-4"});case"Documentation":return e.jsx(A,{className:"w-4 h-4"});case"Supplier":return e.jsx(T,{className:"w-4 h-4"})}},m=t=>{switch(t){case"Open":return"bg-red-100 text-red-700";case"Under Investigation":return"bg-yellow-100 text-yellow-700";case"Pending CAPA":return"bg-blue-100 text-blue-700";case"Closed":return"bg-green-100 text-green-700"}},f=t=>{switch(t){case"Rework":return"bg-blue-100 text-blue-700";case"Scrap":return"bg-red-100 text-red-700";case"Use As Is":return"bg-green-100 text-green-700";case"Return to Supplier":return"bg-orange-100 text-orange-700";case"Pending":return"bg-gray-100 text-gray-700"}},u=Object.entries(l.byType).map(([t,s])=>({name:t,value:s})),N=["#3b82f6","#10b981","#f59e0b","#ef4444"];return e.jsxs("div",{className:"space-y-6 animate-fade-in",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"Non-Conformance Reports"}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"Control of nonconforming product per ISO 13485:8.3"})]}),e.jsxs("button",{onClick:()=>n(!0),className:"btn-primary gap-2",children:[e.jsx(P,{className:"w-4 h-4"}),"New NCR"]})]}),e.jsxs("div",{className:"grid grid-cols-4 gap-4",children:[e.jsx("div",{className:"card",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Total NCRs"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:l.total})]}),e.jsx("div",{className:"w-10 h-10 bg-primary-100 rounded-full flex items-center justify-center",children:e.jsx(y,{className:"w-5 h-5 text-primary-600"})})]})}),e.jsx("div",{className:"card",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Open NCRs"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:l.open})]}),e.jsx("div",{className:h("w-10 h-10 rounded-full flex items-center justify-center",l.open>0?"bg-red-100":"bg-green-100"),children:e.jsx(y,{className:h("w-5 h-5",l.open>0?"text-red-600":"text-green-600")})})]})}),e.jsxs("div",{className:"card col-span-2",children:[e.jsx("p",{className:"text-sm text-gray-500 mb-2",children:"Distribution by Type"}),e.jsx("div",{className:"h-24",children:e.jsx(L,{width:"100%",height:"100%",children:e.jsxs(O,{children:[e.jsx(X,{data:u,cx:"50%",cy:"50%",innerRadius:25,outerRadius:40,dataKey:"value",label:({name:t,value:s})=>`${t}: ${s}`,labelLine:!1,children:u.map((t,s)=>e.jsx(F,{fill:N[s%N.length]},`cell-${s}`))}),e.jsx(U,{})]})})})]})]}),e.jsxs("div",{className:"card flex items-center gap-4",children:[e.jsxs("div",{className:"relative flex-1 max-w-md",children:[e.jsx(R,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Search NCRs...",value:r,onChange:t=>c(t.target.value),className:"input pl-9"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(k,{className:"w-4 h-4 text-gray-400"}),["all","Product","Process","Documentation","Supplier"].map(t=>e.jsxs("button",{onClick:()=>j(t),className:h("px-3 py-1.5 text-sm rounded-md transition-colors flex items-center gap-1",d===t?"bg-primary-100 text-primary-700 font-medium":"bg-surface-100 text-gray-600 hover:bg-surface-200"),children:[t!=="all"&&g(t),t==="all"?"All":t]},t))]})]}),e.jsx("div",{className:"table-container card p-0",children:e.jsxs("table",{className:"table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"NCR ID"}),e.jsx("th",{children:"Type"}),e.jsx("th",{children:"Title"}),e.jsx("th",{children:"Lot/Product"}),e.jsx("th",{children:"Disposition"}),e.jsx("th",{children:"Status"}),e.jsx("th",{children:"Detected"}),e.jsx("th",{children:"Actions"})]})}),e.jsx("tbody",{children:x.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:8,className:"text-center py-8 text-gray-500",children:"No NCRs found"})}):x.map(t=>e.jsxs("tr",{children:[e.jsx("td",{className:"font-mono text-sm",children:t.id.slice(0,8)}),e.jsx("td",{children:e.jsxs("span",{className:"flex items-center gap-1 text-gray-600",children:[g(t.type),t.type]})}),e.jsxs("td",{children:[e.jsx("p",{className:"font-medium text-gray-900",children:t.title}),e.jsx("p",{className:"text-xs text-gray-500 truncate max-w-xs",children:t.description})]}),e.jsxs("td",{children:[t.lotNumber&&e.jsxs("p",{className:"text-sm",children:["Lot: ",t.lotNumber]}),t.productCode&&e.jsx("p",{className:"text-xs text-gray-500",children:t.productCode}),t.quantity&&e.jsxs("p",{className:"text-xs text-gray-500",children:["Qty: ",t.quantity]})]}),e.jsx("td",{children:e.jsx("span",{className:h("badge",f(t.disposition)),children:t.disposition})}),e.jsx("td",{children:e.jsx("span",{className:h("badge",m(t.status)),children:t.status})}),e.jsx("td",{className:"text-sm text-gray-500",children:w(t.detectedAt)}),e.jsx("td",{children:t.status!=="Closed"&&e.jsxs("div",{className:"flex gap-1",children:[t.status==="Open"&&e.jsx("button",{onClick:()=>o(t.id,{status:"Under Investigation"}),className:"btn-ghost btn-sm text-xs",children:"Investigate"}),t.status==="Under Investigation"&&e.jsx("button",{onClick:()=>o(t.id,{status:"Pending CAPA"}),className:"btn-ghost btn-sm text-xs",children:"Link CAPA"}),t.disposition!=="Pending"&&e.jsx("button",{onClick:()=>o(t.id,{status:"Closed",closedAt:new Date}),className:"btn-ghost btn-sm text-xs",children:"Close"})]})})]},t.id))})]})}),e.jsxs("div",{className:"card bg-primary-50 border-primary-200",children:[e.jsx("h4",{className:"font-semibold text-primary-900 mb-2",children:"ISO 13485:2016 - 8.3 Control of Nonconforming Product"}),e.jsx("p",{className:"text-sm text-primary-700",children:"The organization shall ensure that product which does not conform to product requirements is identified and controlled to prevent its unintended use or delivery. A documented procedure shall define the controls and related responsibilities and authorities for dealing with nonconforming product."})]}),b&&e.jsx(q,{onClose:()=>n(!1)})]})}export{V as default};
