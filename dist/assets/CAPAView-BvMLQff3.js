import{a as r,j as e}from"./vendor-react-Coyc-9rJ.js";import{u as D,c as n,a as A,q,r as P}from"./index-BahTgtJs.js";import{X as L,Q as R,a2 as V,o as F,A as k,x as E,m as H,a1 as W,a3 as B,j as Q}from"./vendor-icons-CczvD28u.js";import{v as S}from"./vendor-uuid-CtRu48qb.js";import"./vendor-DW9sAQKa.js";import"./vendor-zustand-Bm6pua9f.js";function U({onClose:m}){const{addCAPA:g}=D(),[u,y]=r.useState("Corrective"),[d,j]=r.useState(""),[h,p]=r.useState(""),[f,v]=r.useState(""),[b,i]=r.useState("Medium"),[c,C]=r.useState(""),[o,s]=r.useState(""),[a,N]=r.useState([]),I=()=>{N([...a,{id:S(),description:"",assignee:"",dueDate:new Date,status:"Pending",verificationRequired:!1}])},O=t=>{N(a.filter((x,l)=>l!==t))},w=(t,x)=>{N(a.map((l,T)=>T===t?{...l,...x}:l))},M=()=>{!d||!h||!c||!o||(g({type:u,title:d,description:h,rootCause:f,status:"Open",priority:b,assignee:c,dueDate:new Date(o),linkedNCRs:[],linkedRiskAssessments:[],isoReferences:[{standard:"ISO 13485:2016",clause:u==="Corrective"?"8.5.2":"8.5.3",description:u==="Corrective"?"Corrective action":"Preventive action"}],actions:a.map(t=>({id:t.id||S(),description:t.description||"",assignee:t.assignee||c,dueDate:t.dueDate||new Date(o),status:"Pending",verificationRequired:t.verificationRequired||!1}))}),m())};return e.jsx("div",{className:"modal-overlay",onClick:m,children:e.jsxs("div",{className:"modal-content p-6 max-w-2xl",onClick:t=>t.stopPropagation(),children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"Create New CAPA"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Per ISO 13485:2016 Clause 8.5.2/8.5.3"})]}),e.jsx("button",{onClick:m,className:"p-1 rounded-md hover:bg-surface-100 text-gray-500",children:e.jsx(L,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"space-y-4 max-h-[60vh] overflow-y-auto pr-2",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Type *"}),e.jsxs("select",{value:u,onChange:t=>y(t.target.value),className:"input",children:[e.jsx("option",{value:"Corrective",children:"Corrective (8.5.2)"}),e.jsx("option",{value:"Preventive",children:"Preventive (8.5.3)"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Priority *"}),e.jsxs("select",{value:b,onChange:t=>i(t.target.value),className:"input",children:[e.jsx("option",{value:"Low",children:"Low"}),e.jsx("option",{value:"Medium",children:"Medium"}),e.jsx("option",{value:"High",children:"High"}),e.jsx("option",{value:"Critical",children:"Critical"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Title *"}),e.jsx("input",{type:"text",value:d,onChange:t=>j(t.target.value),className:"input",placeholder:"Brief description of the issue..."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Description *"}),e.jsx("textarea",{value:h,onChange:t=>p(t.target.value),rows:3,className:"input",placeholder:"Detailed description of the nonconformity or potential issue..."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Root Cause Analysis"}),e.jsx("textarea",{value:f,onChange:t=>v(t.target.value),rows:2,className:"input",placeholder:"Identified root cause (use 5-Why or Fishbone analysis)..."}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Per ISO 13485:8.5.2 - Action to eliminate the cause of nonconformities"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Assignee *"}),e.jsx("input",{type:"text",value:c,onChange:t=>C(t.target.value),className:"input",placeholder:"Responsible person..."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Due Date *"}),e.jsx("input",{type:"date",value:o,onChange:t=>s(t.target.value),className:"input"})]})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Action Items"}),e.jsxs("button",{onClick:I,className:"btn-ghost btn-sm gap-1",children:[e.jsx(R,{className:"w-4 h-4"}),"Add Action"]})]}),e.jsx("div",{className:"space-y-2",children:a.map((t,x)=>e.jsx("div",{className:"p-3 bg-surface-50 rounded-lg",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsxs("div",{className:"flex-1 space-y-2",children:[e.jsx("input",{type:"text",value:t.description,onChange:l=>w(x,{description:l.target.value}),className:"input text-sm",placeholder:"Action description..."}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsx("input",{type:"text",value:t.assignee,onChange:l=>w(x,{assignee:l.target.value}),className:"input text-sm",placeholder:"Assignee..."}),e.jsxs("label",{className:"flex items-center gap-2 text-sm",children:[e.jsx("input",{type:"checkbox",checked:t.verificationRequired,onChange:l=>w(x,{verificationRequired:l.target.checked}),className:"rounded"}),"Verification Required"]})]})]}),e.jsx("button",{onClick:()=>O(x),className:"p-1 text-gray-400 hover:text-red-500",children:e.jsx(V,{className:"w-4 h-4"})})]})},t.id))})]})]}),e.jsxs("div",{className:"flex gap-3 mt-6 pt-4 border-t border-surface-200",children:[e.jsx("button",{onClick:m,className:"btn-secondary flex-1",children:"Cancel"}),e.jsx("button",{onClick:M,disabled:!d||!h||!c||!o,className:"btn-primary flex-1 disabled:opacity-50 disabled:cursor-not-allowed",children:"Create CAPA"})]})]})})}function Y(){const{capas:m,updateCAPA:g,getCAPAStats:u}=D(),[y,d]=r.useState(!1),[j,h]=r.useState(""),[p,f]=r.useState("all"),[v,b]=r.useState(null),i=u(),c=m.filter(s=>{const a=s.title.toLowerCase().includes(j.toLowerCase())||s.description.toLowerCase().includes(j.toLowerCase()),N=p==="all"||s.status===p;return a&&N}),C=s=>{switch(s){case"Critical":return"bg-red-100 text-red-700";case"High":return"bg-orange-100 text-orange-700";case"Medium":return"bg-yellow-100 text-yellow-700";case"Low":return"bg-green-100 text-green-700"}},o=s=>{switch(s){case"Open":return"bg-red-100 text-red-700";case"In Progress":return"bg-blue-100 text-blue-700";case"Verification":return"bg-purple-100 text-purple-700";case"Closed":return"bg-green-100 text-green-700";case"Overdue":return"bg-red-100 text-red-700"}};return e.jsxs("div",{className:"space-y-6 animate-fade-in",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"CAPA Management"}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"Corrective and Preventive Actions per ISO 13485:8.5.2/8.5.3"})]}),e.jsxs("button",{onClick:()=>d(!0),className:"btn-primary gap-2",children:[e.jsx(R,{className:"w-4 h-4"}),"New CAPA"]})]}),e.jsxs("div",{className:"grid grid-cols-4 gap-4",children:[e.jsx("div",{className:"card",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Total CAPAs"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:i.total})]}),e.jsx("div",{className:"w-10 h-10 bg-primary-100 rounded-full flex items-center justify-center",children:e.jsx(F,{className:"w-5 h-5 text-primary-600"})})]})}),e.jsx("div",{className:"card",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Open"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:i.open})]}),e.jsx("div",{className:"w-10 h-10 bg-blue-100 rounded-full flex items-center justify-center",children:e.jsx(k,{className:"w-5 h-5 text-blue-600"})})]})}),e.jsx("div",{className:n("card",i.overdue>0&&"border-red-200 bg-red-50"),children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Overdue"}),e.jsx("p",{className:n("text-2xl font-bold",i.overdue>0?"text-red-600":"text-gray-900"),children:i.overdue})]}),e.jsx("div",{className:n("w-10 h-10 rounded-full flex items-center justify-center",i.overdue>0?"bg-red-100":"bg-gray-100"),children:e.jsx(k,{className:n("w-5 h-5",i.overdue>0?"text-red-600":"text-gray-400")})})]})}),e.jsx("div",{className:"card",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Closed This Month"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:i.closedThisMonth})]}),e.jsx("div",{className:"w-10 h-10 bg-green-100 rounded-full flex items-center justify-center",children:e.jsx(E,{className:"w-5 h-5 text-green-600"})})]})})]}),e.jsxs("div",{className:"card flex items-center gap-4",children:[e.jsxs("div",{className:"relative flex-1 max-w-md",children:[e.jsx(H,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Search CAPAs...",value:j,onChange:s=>h(s.target.value),className:"input pl-9"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(W,{className:"w-4 h-4 text-gray-400"}),["all","Open","In Progress","Verification","Closed"].map(s=>e.jsx("button",{onClick:()=>f(s),className:n("px-3 py-1.5 text-sm rounded-md transition-colors",p===s?"bg-primary-100 text-primary-700 font-medium":"bg-surface-100 text-gray-600 hover:bg-surface-200"),children:s==="all"?"All":s},s))]})]}),e.jsx("div",{className:"space-y-3",children:c.length===0?e.jsx("div",{className:"card text-center py-12 text-gray-500",children:"No CAPAs found. Create a new CAPA to get started."}):c.map(s=>e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"flex items-start justify-between cursor-pointer",onClick:()=>b(v===s.id?null:s.id),children:[e.jsxs("div",{className:"flex items-start gap-3",children:[v===s.id?e.jsx(B,{className:"w-5 h-5 text-gray-400 mt-0.5"}):e.jsx(Q,{className:"w-5 h-5 text-gray-400 mt-0.5"}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:n("badge",s.type==="Corrective"?"badge-red":"badge-blue"),children:s.type}),e.jsx("span",{className:n("badge",C(s.priority)),children:s.priority}),e.jsx("span",{className:n("badge",o(s.status)),children:s.status})]}),e.jsx("h4",{className:"font-medium text-gray-900 mt-2",children:s.title}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:s.description})]})]}),e.jsxs("div",{className:"text-right text-sm",children:[e.jsxs("p",{className:"text-gray-500",children:["Due: ",A(s.dueDate)]}),q(s.dueDate)&&s.status!=="Closed"?e.jsxs("p",{className:"text-red-600 font-medium",children:[Math.abs(P(s.dueDate))," days overdue"]}):s.status!=="Closed"?e.jsxs("p",{className:"text-gray-600",children:[P(s.dueDate)," days remaining"]}):null]})]}),v===s.id&&e.jsxs("div",{className:"mt-4 pt-4 border-t border-surface-200 space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Assignee"}),e.jsx("p",{className:"font-medium",children:s.assignee})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Created"}),e.jsx("p",{className:"font-medium",children:A(s.createdAt)})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"ISO Reference"}),e.jsxs("p",{className:"font-medium text-primary-600",children:["ISO 13485:",s.type==="Corrective"?"8.5.2":"8.5.3"]})]})]}),s.rootCause&&e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Root Cause"}),e.jsx("p",{className:"text-sm mt-1",children:s.rootCause})]}),s.actions.length>0&&e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-700 mb-2",children:"Actions"}),e.jsx("div",{className:"space-y-2",children:s.actions.map(a=>e.jsxs("div",{className:"flex items-center gap-3 p-2 bg-surface-50 rounded",children:[e.jsx("input",{type:"checkbox",checked:a.status==="Completed",onChange:()=>{},className:"w-4 h-4 text-primary-600 rounded"}),e.jsx("span",{className:n("flex-1 text-sm",a.status==="Completed"&&"line-through text-gray-400"),children:a.description}),e.jsx("span",{className:"text-xs text-gray-500",children:a.assignee})]},a.id))})]}),s.status!=="Closed"&&e.jsxs("div",{className:"flex gap-2",children:[s.status==="Open"&&e.jsx("button",{onClick:()=>g(s.id,{status:"In Progress"}),className:"btn-primary btn-sm",children:"Start Work"}),s.status==="In Progress"&&e.jsx("button",{onClick:()=>g(s.id,{status:"Verification"}),className:"btn-primary btn-sm",children:"Submit for Verification"}),s.status==="Verification"&&e.jsx("button",{onClick:()=>g(s.id,{status:"Closed",closedAt:new Date}),className:"btn-primary btn-sm",children:"Close CAPA"})]})]})]},s.id))}),y&&e.jsx(U,{onClose:()=>d(!1)})]})}export{Y as default};
