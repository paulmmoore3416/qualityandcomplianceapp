import{a as o,j as e}from"./vendor-react-Coyc-9rJ.js";import{u as R,M as A,g as V,f as k,c as h,b as I,d as O,e as F,h as L,i as E,j as D,k as $}from"./index-BahTgtJs.js";import{X as U,a0 as q,x as z,A as S,Q as H,m as Q,a1 as G,$ as W,_ as X,Z as Y,I as P}from"./vendor-icons-CczvD28u.js";import{R as K,L as _,C as B,X as Z,Y as J,T as ee,b as M,c as se}from"./vendor-recharts-8rfK60na.js";import"./vendor-DW9sAQKa.js";import"./vendor-zustand-Bm6pua9f.js";import"./vendor-uuid-CtRu48qb.js";function te({onClose:m,preselectedMetricId:C}){const{addMetricValue:d}=R(),[n,p]=o.useState(C||""),[x,u]=o.useState({}),[i,j]=o.useState(null),[g,b]=o.useState(""),[N,a]=o.useState("Quality Engineer"),c=A.find(s=>s.id===n),f=s=>({M001:[{key:"totalStarted",label:"Total Units Started",placeholder:"1000"},{key:"passedFirstTime",label:"Passed First Time",placeholder:"950"}],M002:[{key:"totalNCRs",label:"Total NCRs",placeholder:"15"},{key:"totalUnits",label:"Total Units Produced",placeholder:"1000"}],M003:[{key:"closedCAPAs",label:"Closed CAPAs",placeholder:"18"},{key:"totalOpenCAPAs",label:"Total Open CAPAs",placeholder:"5"}],M004:[{key:"overdueCAPAs",label:"Overdue CAPAs",placeholder:"2"},{key:"totalOpenCAPAs",label:"Total Open CAPAs",placeholder:"10"}],M005:[{key:"releasedLots",label:"Released Lots",placeholder:"48"},{key:"totalLots",label:"Total Lots Manufactured",placeholder:"50"}],M010:[{key:"availability",label:"Availability (%)",placeholder:"90"},{key:"performance",label:"Performance (%)",placeholder:"95"},{key:"quality",label:"Quality (%)",placeholder:"98"}],M019:[{key:"scrapValue",label:"Scrap Value ($)",placeholder:"5000"},{key:"totalMaterialValue",label:"Total Material Value ($)",placeholder:"250000"}]})[s]||[{key:"value",label:"Value",placeholder:"0"}],w=()=>{if(!c)return;const s={};Object.entries(x).forEach(([v,T])=>{s[v]=parseFloat(T)||0});let l;switch(n){case"M001":l=E(s.totalStarted,s.passedFirstTime);break;case"M002":l=L(s.totalNCRs,s.totalUnits);break;case"M003":l=F(s.closedCAPAs,s.totalOpenCAPAs);break;case"M004":l=s.totalOpenCAPAs>0?s.overdueCAPAs/s.totalOpenCAPAs*100:0;break;case"M005":l=O(s.releasedLots,s.totalLots);break;case"M010":l=D(s.availability,s.performance,s.quality).oee;break;case"M019":l=I(s.scrapValue,s.totalMaterialValue);break;default:l=s.value||0}j(l)},t=()=>{if(!c||i===null)return;const s={};Object.entries(x).forEach(([l,v])=>{s[l]=parseFloat(v)||0}),d(n,i,s,N,g),m()},y=n?f(n):[],r=c&&i!==null?V(c,i):null;return e.jsx("div",{className:"modal-overlay",onClick:m,children:e.jsxs("div",{className:"modal-content p-6",onClick:s=>s.stopPropagation(),children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"Record Metric Value"}),e.jsx("button",{onClick:m,className:"p-1 rounded-md hover:bg-surface-100 text-gray-500",children:e.jsx(U,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Select Metric"}),e.jsxs("select",{value:n,onChange:s=>{p(s.target.value),u({}),j(null)},className:"input",children:[e.jsx("option",{value:"",children:"Choose a metric..."}),A.map(s=>e.jsxs("option",{value:s.id,children:[s.shortName," - ",s.name]},s.id))]})]}),c&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mb-4 p-3 bg-primary-50 rounded-lg",children:[e.jsxs("p",{className:"text-sm text-primary-800",children:[e.jsx("strong",{children:"Formula:"})," ",c.formula]}),e.jsxs("p",{className:"text-xs text-primary-600 mt-1",children:["ISO Reference: ",c.isoMappings[0]?.standard,":",c.isoMappings[0]?.clause]})]}),e.jsx("div",{className:"space-y-3 mb-4",children:y.map(s=>e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:s.label}),e.jsx("input",{type:"number",value:x[s.key]||"",onChange:l=>u({...x,[s.key]:l.target.value}),placeholder:s.placeholder,className:"input"})]},s.key))}),e.jsxs("button",{onClick:w,className:"btn-secondary w-full mb-4 gap-2",children:[e.jsx(q,{className:"w-4 h-4"}),"Calculate Value"]}),i!==null&&e.jsxs("div",{className:h("p-4 rounded-lg mb-4 border",r==="green"&&"bg-green-50 border-green-200",r==="yellow"&&"bg-yellow-50 border-yellow-200",r==="red"&&"bg-red-50 border-red-200"),children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Calculated Value"}),e.jsxs("p",{className:"text-2xl font-bold text-gray-900",children:[k(i,2),c.unit]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[r==="green"&&e.jsx(z,{className:"w-6 h-6 text-green-600"}),r==="yellow"&&e.jsx(S,{className:"w-6 h-6 text-yellow-600"}),r==="red"&&e.jsx(S,{className:"w-6 h-6 text-red-600"}),e.jsx("span",{className:h("font-medium capitalize",r==="green"&&"text-green-700",r==="yellow"&&"text-yellow-700",r==="red"&&"text-red-700"),children:r})]})]}),r==="red"&&e.jsx("p",{className:"mt-2 text-sm text-red-600",children:"This value requires immediate attention. Consider initiating a CAPA per ISO 13485:8.5.2."})]}),e.jsxs("div",{className:"space-y-3 mb-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Recorded By"}),e.jsx("input",{type:"text",value:N,onChange:s=>a(s.target.value),className:"input"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Notes (Optional)"}),e.jsx("textarea",{value:g,onChange:s=>b(s.target.value),rows:2,className:"input",placeholder:"Add any relevant observations or context..."})]})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:m,className:"btn-secondary flex-1",children:"Cancel"}),e.jsx("button",{onClick:t,disabled:i===null,className:"btn-primary flex-1 disabled:opacity-50 disabled:cursor-not-allowed",children:"Save Record"})]})]})]})})}function de(){const{getDashboardMetrics:m,getMetricHistory:C,selectedMetricId:d,setSelectedMetricId:n}=R(),[p,x]=o.useState(""),[u,i]=o.useState("all"),[j,g]=o.useState(!1),b=m(),N=b.filter(t=>{const y=t.metric.name.toLowerCase().includes(p.toLowerCase())||t.metric.shortName.toLowerCase().includes(p.toLowerCase()),r=u==="all"||t.metric.category===u;return y&&r}),a=d?b.find(t=>t.metric.id===d):null,f=(d?C(d,30):[]).map(t=>({date:$(t.timestamp).split(",")[0],value:t.value})).reverse(),w=["all","Quality","Compliance","Operational","Financial"];return e.jsxs("div",{className:"space-y-6 animate-fade-in",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"Metrics Management"}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"Track and manage quality, compliance, and operational metrics"})]}),e.jsxs("button",{onClick:()=>g(!0),className:"btn-primary gap-2",children:[e.jsx(H,{className:"w-4 h-4"}),"Record Value"]})]}),e.jsxs("div",{className:"card flex items-center gap-4",children:[e.jsxs("div",{className:"relative flex-1 max-w-md",children:[e.jsx(Q,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Search metrics...",value:p,onChange:t=>x(t.target.value),className:"input pl-9"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(G,{className:"w-4 h-4 text-gray-400"}),w.map(t=>e.jsx("button",{onClick:()=>i(t),className:h("px-3 py-1.5 text-sm rounded-md transition-colors",u===t?"bg-primary-100 text-primary-700 font-medium":"bg-surface-100 text-gray-600 hover:bg-surface-200"),children:t==="all"?"All":t},t))]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-6",children:[e.jsx("div",{className:"col-span-1 space-y-2 max-h-[calc(100vh-300px)] overflow-y-auto",children:N.map(t=>e.jsx("div",{onClick:()=>n(t.metric.id),className:h("card cursor-pointer transition-all duration-200 hover:shadow-card-hover border-l-4",t.status==="green"&&"border-l-compliance-green",t.status==="yellow"&&"border-l-compliance-yellow",t.status==="red"&&"border-l-compliance-red",d===t.metric.id&&"ring-2 ring-primary-500"),children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900",children:t.metric.shortName}),e.jsx("p",{className:"text-xs text-gray-500",children:t.metric.category})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"font-bold text-gray-900",children:t.currentValue?`${k(t.currentValue.value,1)}${t.metric.unit}`:"--"}),e.jsxs("div",{className:"flex items-center gap-1 justify-end",children:[t.trend==="improving"&&e.jsx(W,{className:"w-3 h-3 text-green-500"}),t.trend==="declining"&&e.jsx(X,{className:"w-3 h-3 text-red-500"}),t.trend==="stable"&&e.jsx(Y,{className:"w-3 h-3 text-gray-400"}),e.jsx("span",{className:h("text-xs",t.trend==="improving"&&"text-green-600",t.trend==="declining"&&"text-red-600",t.trend==="stable"&&"text-gray-500"),children:t.changePercent!==void 0?`${t.changePercent>0?"+":""}${k(t.changePercent,1)}%`:"No change"})]})]})]})},t.metric.id))}),e.jsx("div",{className:"col-span-2",children:a?e.jsxs("div",{className:"card space-y-6",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-semibold text-gray-900",children:a.metric.name}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:a.metric.description})]}),e.jsx("span",{className:h("px-3 py-1 rounded-full text-sm font-medium",a.status==="green"&&"bg-green-100 text-green-700",a.status==="yellow"&&"bg-yellow-100 text-yellow-700",a.status==="red"&&"bg-red-100 text-red-700"),children:a.status.toUpperCase()})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{className:"bg-surface-50 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Current Value"}),e.jsx("p",{className:"text-3xl font-bold text-gray-900 mt-1",children:a.currentValue?`${k(a.currentValue.value,2)}${a.metric.unit}`:"--"})]}),e.jsxs("div",{className:"bg-surface-50 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Target (Green)"}),e.jsxs("p",{className:"text-3xl font-bold text-green-600 mt-1",children:[a.metric.threshold.direction==="higher-better"?"≥":"≤",a.metric.threshold.green,a.metric.unit]})]}),e.jsxs("div",{className:"bg-surface-50 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Formula"}),e.jsx("p",{className:"text-sm font-mono text-gray-700 mt-1",children:a.metric.formula})]})]}),f.length>0&&e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-semibold text-gray-700 mb-3",children:"Historical Trend"}),e.jsx("div",{className:"h-64",children:e.jsx(K,{width:"100%",height:"100%",children:e.jsxs(_,{data:f,children:[e.jsx(B,{strokeDasharray:"3 3",stroke:"#e2e8f0"}),e.jsx(Z,{dataKey:"date",tick:{fontSize:11},stroke:"#94a3b8"}),e.jsx(J,{tick:{fontSize:11},stroke:"#94a3b8",domain:["auto","auto"]}),e.jsx(ee,{contentStyle:{backgroundColor:"white",border:"1px solid #e2e8f0",borderRadius:"8px"}}),e.jsx(M,{y:a.metric.threshold.green,stroke:"#10b981",strokeDasharray:"5 5",label:{value:"Target",position:"right",fontSize:10}}),e.jsx(M,{y:a.metric.threshold.yellow,stroke:"#f59e0b",strokeDasharray:"5 5"}),e.jsx(M,{y:a.metric.threshold.red,stroke:"#ef4444",strokeDasharray:"5 5"}),e.jsx(se,{type:"monotone",dataKey:"value",stroke:"#3b82f6",strokeWidth:2,dot:{fill:"#3b82f6",strokeWidth:2}})]})})})]}),e.jsxs("div",{children:[e.jsxs("h4",{className:"text-sm font-semibold text-gray-700 mb-3 flex items-center gap-2",children:[e.jsx(P,{className:"w-4 h-4"}),"ISO Standard References"]}),e.jsx("div",{className:"space-y-2",children:a.metric.isoMappings.map((t,y)=>e.jsxs("div",{className:"bg-primary-50 rounded-lg p-3",children:[e.jsxs("p",{className:"font-medium text-primary-800",children:[t.standard,":",t.clause]}),e.jsx("p",{className:"text-sm text-primary-600",children:t.description})]},y))})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-semibold text-gray-700 mb-2",children:"Risk Impact"}),e.jsx("p",{className:"text-sm text-gray-600 bg-surface-50 rounded-lg p-3",children:a.metric.riskImpact})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-semibold text-gray-700 mb-2",children:"Workaround Suggestion"}),e.jsx("p",{className:"text-sm text-gray-600 bg-surface-50 rounded-lg p-3",children:a.metric.workaroundSuggestion})]})]})]}):e.jsxs("div",{className:"card flex flex-col items-center justify-center h-96 text-gray-500",children:[e.jsx(P,{className:"w-12 h-12 mb-4 text-gray-300"}),e.jsx("p",{children:"Select a metric to view details"})]})})]}),j&&e.jsx(te,{onClose:()=>g(!1)})]})}export{de as default};
