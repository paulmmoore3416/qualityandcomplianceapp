import{a,j as e}from"./vendor-react-Coyc-9rJ.js";import{c as r,a as V}from"./index-BahTgtJs.js";import{X as Q,S as C,A as g,V as R,Q as O,G as z,o as k,x as w,m as U,g as G,ag as J}from"./vendor-icons-CczvD28u.js";import"./vendor-DW9sAQKa.js";import"./vendor-zustand-Bm6pua9f.js";import"./vendor-uuid-CtRu48qb.js";function W({onClose:d}){const[j,c]=a.useState("Process"),[y,o]=a.useState("Minor"),[m,x]=a.useState(""),[u,n]=a.useState(""),[h,i]=a.useState(""),[p,v]=a.useState(""),[s,l]=a.useState("Low"),[f,N]=a.useState("Low"),[S,A]=a.useState("None"),[D,q]=a.useState(!1),[M,P]=a.useState(!1),[I,T]=a.useState(!1),[b,B]=a.useState(""),[L,H]=a.useState("I certify that this change request is necessary and the impact assessment is accurate."),E=s==="High"||f==="High"||S==="High",F=()=>{!m||!u||!h||!p||!b||(console.log("Creating change control with digital signature"),d())};return e.jsx("div",{className:"modal-overlay",onClick:d,children:e.jsxs("div",{className:"modal-content p-6 max-w-3xl",onClick:t=>t.stopPropagation(),children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"New Change Control Request"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Per ISO 13485:7.3.9 & 21 CFR Part 11 - Electronic Signatures"})]}),e.jsx("button",{onClick:d,className:"p-1 rounded-md hover:bg-surface-100 text-gray-500",children:e.jsx(Q,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"space-y-5 max-h-[65vh] overflow-y-auto pr-2",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-sm font-semibold text-gray-700 uppercase tracking-wide border-b border-surface-200 pb-2",children:"Change Details"}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Type *"}),e.jsxs("select",{value:j,onChange:t=>c(t.target.value),className:"input",children:[e.jsx("option",{value:"Design",children:"Design"}),e.jsx("option",{value:"Process",children:"Process"}),e.jsx("option",{value:"Material",children:"Material"}),e.jsx("option",{value:"Supplier",children:"Supplier"}),e.jsx("option",{value:"Document",children:"Document"}),e.jsx("option",{value:"Software",children:"Software"}),e.jsx("option",{value:"Equipment",children:"Equipment"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Classification *"}),e.jsxs("select",{value:y,onChange:t=>o(t.target.value),className:"input",children:[e.jsx("option",{value:"Administrative",children:"Administrative"}),e.jsx("option",{value:"Minor",children:"Minor"}),e.jsx("option",{value:"Major",children:"Major"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Requested By *"}),e.jsx("input",{type:"text",value:p,onChange:t=>v(t.target.value),className:"input",placeholder:"Name / Role"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Title *"}),e.jsx("input",{type:"text",value:m,onChange:t=>x(t.target.value),className:"input",placeholder:"Brief description of the change..."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Description *"}),e.jsx("textarea",{value:u,onChange:t=>n(t.target.value),rows:3,className:"input",placeholder:"What is being changed and how..."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Justification *"}),e.jsx("textarea",{value:h,onChange:t=>i(t.target.value),rows:2,className:"input",placeholder:"Why is this change necessary..."})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-sm font-semibold text-gray-700 uppercase tracking-wide border-b border-surface-200 pb-2",children:"Impact Assessment"}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:[e.jsx(C,{className:"w-4 h-4 inline mr-1"}),"Safety Impact"]}),e.jsxs("select",{value:s,onChange:t=>l(t.target.value),className:"input",children:[e.jsx("option",{value:"None",children:"None"}),e.jsx("option",{value:"Low",children:"Low"}),e.jsx("option",{value:"Medium",children:"Medium"}),e.jsx("option",{value:"High",children:"High"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Quality Impact"}),e.jsxs("select",{value:f,onChange:t=>N(t.target.value),className:"input",children:[e.jsx("option",{value:"None",children:"None"}),e.jsx("option",{value:"Low",children:"Low"}),e.jsx("option",{value:"Medium",children:"Medium"}),e.jsx("option",{value:"High",children:"High"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Regulatory Impact"}),e.jsxs("select",{value:S,onChange:t=>A(t.target.value),className:"input",children:[e.jsx("option",{value:"None",children:"None"}),e.jsx("option",{value:"Low",children:"Low"}),e.jsx("option",{value:"Medium",children:"Medium"}),e.jsx("option",{value:"High",children:"High"})]})]})]}),E&&e.jsx("div",{className:"p-3 bg-yellow-50 border border-yellow-200 rounded-lg",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(g,{className:"w-4 h-4 text-yellow-600"}),e.jsx("span",{className:"text-sm font-medium text-yellow-800",children:"High impact detected - additional reviews may be required"})]})}),e.jsxs("div",{className:"bg-surface-50 rounded-lg p-4 space-y-3",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-700",children:"Required Actions"}),e.jsxs("label",{className:"flex items-center gap-3",children:[e.jsx("input",{type:"checkbox",checked:D,onChange:t=>q(t.target.checked),className:"w-4 h-4 rounded"}),e.jsx("span",{className:"text-sm text-gray-700",children:"Risk Assessment Required (ISO 14971)"})]}),e.jsxs("label",{className:"flex items-center gap-3",children:[e.jsx("input",{type:"checkbox",checked:M,onChange:t=>P(t.target.checked),className:"w-4 h-4 rounded"}),e.jsx("span",{className:"text-sm text-gray-700",children:"Validation Required (IQ/OQ/PQ)"})]}),e.jsxs("label",{className:"flex items-center gap-3",children:[e.jsx("input",{type:"checkbox",checked:I,onChange:t=>T(t.target.checked),className:"w-4 h-4 rounded"}),e.jsx("span",{className:"text-sm text-gray-700",children:"Regulatory Submission Required"})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h3",{className:"text-sm font-semibold text-gray-700 uppercase tracking-wide border-b border-surface-200 pb-2 flex items-center gap-2",children:[e.jsx(R,{className:"w-4 h-4"}),"Digital Signature (21 CFR Part 11)"]}),e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4 space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Meaning of Signature"}),e.jsx("textarea",{value:L,onChange:t=>H(t.target.value),rows:2,className:"input text-sm"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Per 21 CFR 11.50 - Signature Manifestations"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Password / PIN *"}),e.jsx("input",{type:"password",value:b,onChange:t=>B(t.target.value),className:"input",placeholder:"Enter your credentials to sign..."}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Your identity will be verified and linked to this record per 21 CFR 11.70"})]}),e.jsxs("div",{className:"text-xs text-blue-700 bg-blue-100 rounded p-2",children:[e.jsx("strong",{children:"Audit Trail:"})," This submission will record your User ID, timestamp (",new Date().toLocaleString(),"), meaning of signature, and IP address in a non-editable audit log."]})]})]})]}),e.jsxs("div",{className:"flex gap-3 mt-6 pt-4 border-t border-surface-200",children:[e.jsx("button",{onClick:d,className:"btn-secondary flex-1",children:"Cancel"}),e.jsxs("button",{onClick:F,disabled:!m||!u||!h||!p||!b,className:"btn-primary flex-1 gap-2 disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx(R,{className:"w-4 h-4"}),"Sign & Submit"]})]})]})})}const X=[{id:"1",referenceNumber:"CC-2026-001",type:"Process",classification:"Major",title:"Update sterilization cycle parameters",description:"Modify EO sterilization cycle time based on validation data",justification:"Validation study showed improved SAL with modified parameters",requestedBy:"Process Engineer",requestedDate:new Date("2026-01-20"),impactAssessment:{safetyImpact:"Medium",qualityImpact:"High",regulatoryImpact:"High",affectedDocuments:["SOP-STER-001","VAL-STER-003"],affectedProducts:["MDV-1000","MDV-2000"],affectedProcesses:["Sterilization"],riskAssessmentRequired:!0,validationRequired:!0,regulatorySubmissionRequired:!1},linkedRiskAssessments:[],linkedCAPAs:[],linkedDocuments:["SOP-STER-001"],approvals:[{id:"1",role:"Quality",approverName:"QA Manager",approverId:"USR-001",decision:"Approved",comments:"Approved pending validation completion",timestamp:new Date("2026-01-22")},{id:"2",role:"Engineering",approverName:"Engineering Lead",approverId:"USR-002",decision:"Approved",timestamp:new Date("2026-01-23")},{id:"3",role:"Regulatory",approverName:"",approverId:"",decision:"Pending"}],status:"Pending Review",createdAt:new Date("2026-01-20"),auditTrail:[]},{id:"2",referenceNumber:"CC-2026-002",type:"Material",classification:"Minor",title:"Alternative packaging material supplier",description:"Qualify secondary supplier for sterile pouches",justification:"Supply chain risk mitigation - single source dependency",requestedBy:"Supply Chain Manager",requestedDate:new Date("2026-01-15"),impactAssessment:{safetyImpact:"Low",qualityImpact:"Medium",regulatoryImpact:"Low",affectedDocuments:["ASL-001"],affectedProducts:["All"],affectedProcesses:["Packaging"],riskAssessmentRequired:!0,validationRequired:!1,regulatorySubmissionRequired:!1},linkedRiskAssessments:[],linkedCAPAs:[],linkedDocuments:[],approvals:[{id:"1",role:"Quality",approverName:"QA Manager",approverId:"USR-001",decision:"Approved",timestamp:new Date("2026-01-18")}],status:"Approved",createdAt:new Date("2026-01-15"),auditTrail:[]},{id:"3",referenceNumber:"CC-2026-003",type:"Design",classification:"Major",title:"Risk threshold breach - Battery thermal hazard",description:"Real-world occurrence rate exceeds design estimate for H-04",justification:"Complaint data shows 0.08% occurrence vs 0.01% design estimate",requestedBy:"System (Auto-triggered)",requestedDate:new Date("2026-01-25"),impactAssessment:{safetyImpact:"High",qualityImpact:"High",regulatoryImpact:"High",affectedDocuments:["RMF-001","DHF-MDV1000"],affectedProducts:["MDV-1000"],affectedProcesses:["Design","Manufacturing"],riskAssessmentRequired:!0,validationRequired:!0,regulatorySubmissionRequired:!0},triggeredByRiskBreach:{hazardId:"H-04",designEstimate:.01,actualRate:.08,variance:700},linkedRiskAssessments:["RA-001"],linkedCAPAs:[],linkedDocuments:[],approvals:[],status:"Draft",createdAt:new Date("2026-01-25"),auditTrail:[]}];function se(){const[d,j]=a.useState(!1),[c,y]=a.useState(""),[o,m]=a.useState("all"),[x,u]=a.useState("all"),n=X,h=n.filter(s=>{const l=s.title.toLowerCase().includes(c.toLowerCase())||s.referenceNumber.toLowerCase().includes(c.toLowerCase()),f=o==="all"||s.type===o,N=x==="all"||s.status===x;return l&&f&&N}),i={openChanges:n.filter(s=>s.status!=="Closed"&&s.status!=="Rejected").length,pendingApprovals:n.filter(s=>s.status==="Pending Review").length,riskTriggered:n.filter(s=>s.triggeredByRiskBreach).length,implementedThisMonth:n.filter(s=>s.status==="Implemented").length},p=s=>{switch(s){case"Draft":return"bg-gray-100 text-gray-700";case"Pending Review":return"bg-yellow-100 text-yellow-700";case"Approved":return"bg-green-100 text-green-700";case"Rejected":return"bg-red-100 text-red-700";case"Implemented":return"bg-blue-100 text-blue-700";case"Closed":return"bg-gray-100 text-gray-700"}},v=s=>{switch(s){case"Major":return"bg-red-100 text-red-700";case"Minor":return"bg-yellow-100 text-yellow-700";case"Administrative":return"bg-gray-100 text-gray-700"}};return e.jsxs("div",{className:"space-y-6 animate-fade-in",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"Change Control"}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"Per ISO 13485:7.3.9 & 21 CFR Part 11 - Electronic Records & Signatures"})]}),e.jsxs("button",{onClick:()=>j(!0),className:"btn-primary gap-2",children:[e.jsx(O,{className:"w-4 h-4"}),"New Change Request"]})]}),i.riskTriggered>0&&e.jsx("div",{className:"card bg-red-50 border-red-300",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-red-100 rounded-full flex items-center justify-center",children:e.jsx(g,{className:"w-5 h-5 text-red-600"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-semibold text-red-900",children:"Risk Threshold Breach Detected"}),e.jsxs("p",{className:"text-sm text-red-700",children:[i.riskTriggered," change(s) auto-triggered by ISO 14971 risk data exceeding design estimates. Per ISO 13485:4.1.4, immediate review and disposition required."]})]}),e.jsx("button",{className:"btn-danger btn-sm",children:"Review Now"})]})}),e.jsxs("div",{className:"grid grid-cols-4 gap-4",children:[e.jsx("div",{className:"card",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Open Changes"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:i.openChanges})]}),e.jsx("div",{className:"w-10 h-10 bg-primary-100 rounded-full flex items-center justify-center",children:e.jsx(z,{className:"w-5 h-5 text-primary-600"})})]})}),e.jsx("div",{className:r("card",i.pendingApprovals>0&&"border-yellow-300 bg-yellow-50"),children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Pending Approval"}),e.jsx("p",{className:r("text-2xl font-bold",i.pendingApprovals>0?"text-yellow-600":"text-gray-900"),children:i.pendingApprovals})]}),e.jsx("div",{className:"w-10 h-10 bg-yellow-100 rounded-full flex items-center justify-center",children:e.jsx(k,{className:"w-5 h-5 text-yellow-600"})})]})}),e.jsx("div",{className:r("card",i.riskTriggered>0&&"border-red-300 bg-red-50"),children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Risk-Triggered"}),e.jsx("p",{className:r("text-2xl font-bold",i.riskTriggered>0?"text-red-600":"text-gray-900"),children:i.riskTriggered})]}),e.jsx("div",{className:"w-10 h-10 bg-red-100 rounded-full flex items-center justify-center",children:e.jsx(g,{className:"w-5 h-5 text-red-600"})})]})}),e.jsx("div",{className:"card",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Implemented (MTD)"}),e.jsx("p",{className:"text-2xl font-bold text-green-600",children:i.implementedThisMonth})]}),e.jsx("div",{className:"w-10 h-10 bg-green-100 rounded-full flex items-center justify-center",children:e.jsx(w,{className:"w-5 h-5 text-green-600"})})]})})]}),e.jsxs("div",{className:"card flex items-center gap-4 flex-wrap",children:[e.jsxs("div",{className:"relative flex-1 max-w-md",children:[e.jsx(U,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Search changes...",value:c,onChange:s=>y(s.target.value),className:"input pl-9"})]}),e.jsxs("select",{value:o,onChange:s=>m(s.target.value),className:"input w-auto",children:[e.jsx("option",{value:"all",children:"All Types"}),e.jsx("option",{value:"Design",children:"Design"}),e.jsx("option",{value:"Process",children:"Process"}),e.jsx("option",{value:"Material",children:"Material"}),e.jsx("option",{value:"Supplier",children:"Supplier"}),e.jsx("option",{value:"Document",children:"Document"}),e.jsx("option",{value:"Software",children:"Software"})]}),e.jsx("div",{className:"flex items-center gap-2",children:["all","Draft","Pending Review","Approved","Implemented"].map(s=>e.jsx("button",{onClick:()=>u(s),className:r("px-3 py-1.5 text-sm rounded-md transition-colors",x===s?"bg-primary-100 text-primary-700 font-medium":"bg-surface-100 text-gray-600 hover:bg-surface-200"),children:s==="all"?"All":s},s))})]}),e.jsx("div",{className:"space-y-4",children:h.map(s=>e.jsxs("div",{className:r("card",s.triggeredByRiskBreach&&"border-red-300 bg-red-50"),children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx("span",{className:"font-mono text-sm text-gray-500",children:s.referenceNumber}),e.jsx("span",{className:r("badge",v(s.classification)),children:s.classification}),e.jsx("span",{className:"badge badge-gray",children:s.type}),e.jsx("span",{className:r("badge",p(s.status)),children:s.status}),s.triggeredByRiskBreach&&e.jsxs("span",{className:"badge bg-red-100 text-red-700",children:[e.jsx(g,{className:"w-3 h-3 mr-1"}),"Risk Triggered"]})]}),e.jsx("h3",{className:"font-medium text-gray-900 mt-2",children:s.title}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:s.description}),s.triggeredByRiskBreach&&e.jsxs("div",{className:"mt-3 p-3 bg-white rounded-lg border border-red-200",children:[e.jsx("p",{className:"text-sm font-medium text-red-800",children:"Risk Data Comparison"}),e.jsxs("div",{className:"grid grid-cols-3 gap-4 mt-2 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Design Estimate:"}),e.jsxs("span",{className:"ml-2 font-medium",children:[s.triggeredByRiskBreach.designEstimate,"%"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Actual Rate:"}),e.jsxs("span",{className:"ml-2 font-medium text-red-600",children:[s.triggeredByRiskBreach.actualRate,"%"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Variance:"}),e.jsxs("span",{className:"ml-2 font-medium text-red-600",children:["+",s.triggeredByRiskBreach.variance,"%"]})]})]})]}),e.jsxs("div",{className:"mt-3 flex items-center gap-4 text-sm",children:[e.jsxs("span",{className:r("flex items-center gap-1",s.impactAssessment.safetyImpact==="High"?"text-red-600":s.impactAssessment.safetyImpact==="Medium"?"text-yellow-600":"text-green-600"),children:[e.jsx(C,{className:"w-4 h-4"}),"Safety: ",s.impactAssessment.safetyImpact]}),s.impactAssessment.validationRequired&&e.jsxs("span",{className:"text-blue-600 flex items-center gap-1",children:[e.jsx(w,{className:"w-4 h-4"}),"Validation Required"]}),s.impactAssessment.regulatorySubmissionRequired&&e.jsxs("span",{className:"text-purple-600 flex items-center gap-1",children:[e.jsx(G,{className:"w-4 h-4"}),"Regulatory Submission"]})]})]}),e.jsxs("div",{className:"ml-6 min-w-[200px]",children:[e.jsx("p",{className:"text-sm font-medium text-gray-700 mb-2",children:"Approvals"}),e.jsx("div",{className:"space-y-1",children:s.approvals.map(l=>e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"text-gray-600",children:l.role}),l.decision==="Approved"?e.jsx(w,{className:"w-4 h-4 text-green-500"}):l.decision==="Rejected"?e.jsx(g,{className:"w-4 h-4 text-red-500"}):e.jsx(k,{className:"w-4 h-4 text-yellow-500"})]},l.id))}),s.status==="Pending Review"&&e.jsxs("button",{className:"btn-primary btn-sm w-full mt-3 gap-1",children:[e.jsx(J,{className:"w-3 h-3"}),"Sign & Approve"]})]})]}),e.jsxs("div",{className:"mt-4 pt-4 border-t border-surface-200 flex items-center justify-between text-xs text-gray-500",children:[e.jsxs("span",{children:["Requested by ",s.requestedBy," on ",V(s.requestedDate)]}),e.jsxs("span",{children:["Affected: ",s.impactAssessment.affectedProducts.length," product(s),"," ",s.impactAssessment.affectedDocuments.length," document(s)"]})]})]},s.id))}),e.jsxs("div",{className:"card bg-primary-50 border-primary-200",children:[e.jsx("h4",{className:"font-semibold text-primary-900 mb-2",children:"21 CFR Part 11 Compliance"}),e.jsxs("div",{className:"grid grid-cols-3 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-primary-800",children:"11.10 Controls"}),e.jsx("p",{className:"text-primary-600",children:"System validation, audit trails, authority checks"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-primary-800",children:"11.50 Signature Manifestations"}),e.jsx("p",{className:"text-primary-600",children:"Printed name, date/time, meaning of signature"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-primary-800",children:"11.70 Signature Linking"}),e.jsx("p",{className:"text-primary-600",children:"Signatures linked to respective electronic records"})]})]})]}),d&&e.jsx(W,{onClose:()=>j(!1)})]})}export{se as default};
